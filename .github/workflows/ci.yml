name: CI/CD Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        python-version: ["3.9"]

    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pytest
    
    - name: Run simple tests
      run: |
        # Create a simple test if none exist
        if [ ! -f "tests/test_simple.py" ]; then
          cat > tests/test_simple.py << 'EOF'
          def test_basic():
              assert 1 + 1 == 2
          
          def test_structure():
              import os
              assert os.path.exists("main.py")
              assert os.path.exists("docs/projectdocumentation.md")
          EOF
        fi
        
        python -m pytest tests/ -v
    
  verify:
    runs-on: ubuntu-latest
    needs: test
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Verify project
      run: |
        echo "Verifying project structure..."
        python -c "
        import os
        required_files = ['main.py', 'README.md', 'docs/projectdocumentation.md', 'data/product_input.json']
        all_exist = all(os.path.exists(f) for f in required_files)
        print(f'All required files exist: {all_exist}')
        if not all_exist:
            for f in required_files:
                if not os.path.exists(f):
                    print(f'Missing: {f}')
            exit(1)
        "
        
    - name: Run main.py
      run: |
        python main.py
        echo "Checking outputs..."
        ls -la outputs/
